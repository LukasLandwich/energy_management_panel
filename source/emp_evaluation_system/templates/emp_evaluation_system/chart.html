<div class="col-xl-12 col-lg-12">
    <div class="card shadow mb-4">
        <!-- Card Header - Dropdown -->
        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
            {% if chart.chart_has_title %}
                <h6 class="m-0 font-weight-bold text-primary">{{chart.chart_title}}</h6>
            {% endif %}
            <div class="dropdown no-arrow">
                <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                    data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                    aria-labelledby="dropdownMenuLink">
                    <div class="dropdown-header">Change Interval</div>
                        {% for label in chart.chart_data_interval %}
                            <a class="dropdown-item" href=""> {{label}} </a>
                        {% endfor %} 
                </div>
            </div>
        </div>
        <!-- Card Body -->
        <div class="card-body">
            <div class="chart-area">
                <canvas id="myAreaChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>

function setUpGraphs() {
    var datasetsTypes = "{{chart.chart_data_sets}}".split(", ");
    var datasets = [];
    var datalables = [];
    for (type in datasetsTypes) {     
        switch(datasetsTypes[type]) {
            case "history":
                var datapointSet = [];
                var timestampset = getLast24Hours(getTimestampOfLastFullHour())
                $.each(timestampset, (index, timestamp) => {
                    getDatapointValueOf({{datapoint.id}}, timestamp).then((data) => {
                            datapointSet.push(data.value);
                            if (index == timestampset.length - 1) {
                                datasets.push(datapointSet);
                                datalables.push("Consumption History"); 
                                areaChart("myAreaChart", datasets, 
                                    ["00:00", "1:00", "2:00", "3:00", "4:00", "5:00", "6:00", "7:00", "8:00", "9:00", "10:00", "11:00", "12:00", "13:00", 
                                    "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00"],
                                    datalables);
                                    console.log(datapointSet)
                            }
                        }
                    );
                });                     
                /*getDatapointValues({{datapoint.id}}).then( (response) => {
                        var setValues = getLastXDatapointValuesOfSet(response, 24);
                        datasets.push(setValues);
                        console.log(datasets);
                        areaChart("myAreaChart", datasets, 
                        ["00:00", "1:00", "2:00", "3:00", "4:00", "5:00", "6:00", "7:00", "8:00", "9:00", "10:00", "11:00", "12:00", "13:00", 
                        "14:00", "15:00", "16:00", "17:00", "18:00", "19:00", "20:00", "21:00", "22:00", "23:00"],
                        datalables);
                    }
                );   */
            break;
            case "forecast":
                datasets.push([60, 100, 120, 170, 250, 110, 170, 150, 190, 25, 0, 90])
                datalables.push("Consumption Forecast");
            break;
            case "schedule":
                datasets.push([60, 150, 120, 170, 10, 10, 70, 250, 90, 250, 0, 90])
                datalables.push("Consumption Schedule");
            break;
            case "setpoints":
                datasets.push([60, 180, 120, 110, 100, 100, 150, 250, 95, 150, 0, 90])
                datalables.push("Consumption Setpoints");
            break;
            default:
            break;
        }
    }
    
}


$( document ).ready(function() {   

    setUpGraphs()     
});

</script>